import requests
import re
import os

def main():
    # Provide explanation for the user.
    print("Welcome!")
    print("To retrieve the Bundle ID of an App Store app, you need its App ID.")
    print("When you copy an App Store link, you'll see something like:")
    print("  https://apps.apple.com/us/app/instagram/id389801252?mt=8")
    print("In this example, the App ID is '389801252' (the numbers following 'id').")
    print("You can paste either the full URL or just the numeric App ID.\n")
    
    # Wait for the user to enter the App ID or URL.
    user_input = input("Enter the App Store URL or the App ID: ").strip()
    
    # Extract the numeric app ID from the input.
    id_match = re.search(r'(\d+)', user_input)
    if not id_match:
        print("Could not extract an App ID from your input. Please ensure you provide a valid App Store URL or app ID.")
        return
    
    app_id = id_match.group(1)
    print(f"Extracted App ID: {app_id}\n")
    
    # Construct the iTunes Lookup URL using the extracted app ID.
    lookup_url = f"https://itunes.apple.com/lookup?id={app_id}"
    
    # Request the app details from the iTunes Lookup API.
    response = requests.get(lookup_url)
    if response.status_code != 200:
        print("Failed to retrieve app details from the iTunes API.")
        return

    # Save the API response to a temporary file.
    filename = "appinfo.txt"
    with open(filename, "w", encoding="utf-8") as file:
        file.write(response.text)
    
    # Read the file content.
    with open(filename, "r", encoding="utf-8") as file:
        content = file.read()
    
    # Extract the bundle ID using a regular expression.
    match = re.search(r'"bundleId"\s*:\s*"([^"]+)"', content)
    if match:
        bundle_id = match.group(1)
        print("Bundle ID:", bundle_id)
    else:
        print("Bundle ID not found in the retrieved data.")
    
    # Delete the temporary file.
    try:
        os.remove(filename)
    except OSError as e:
        print("Error deleting the temporary file:", e)

if __name__ == "__main__":
    main()
